#!/usr/bin/env bash
VERSION='v1.4.4'

warn()  { echo "$@" >&2;        }
die()   { warn "$@"; exit 1;    }

while [ $# -gt 1 -o "${1:0:1}" == "-" ]; do
    opts=(${opts[@]} $1)
    shift
done

if [ $# -eq 1 ]; then
    cmd=(sh -c "run /lib/sh/profile; $1; shutdown -h")
fi

export INFERNO_HOME=$(pwd)
exec emu-g "${opts[@]}" "${cmd[@]}"


: <<'=cut'

=encoding utf8

=head1 NAME

narada-emu - start OS Inferno's emu-g for this project


=head1 VERSION

This document describes narada-emu version v1.4.4


=head1 USAGE

    narada-emu [options] [command]


=head1 DESCRIPTION

Start emu-g using project root directory as OS Inferno's user home directory.

With "command" parameter will initialize emu in usual way
(/lib/sh/profile), run given "command", and after "command" exits will
shutdown emu (even if there still some active background processes).

Script must be executed only from "project root directory".


=head1 REQUIRED ARGUMENTS

None.


=head1 OPTIONS

See USAGE.


=head1 DIAGNOSTICS

None.


=head1 CONFIGURATION AND ENVIRONMENT

Depends on OS Inferno setup. Usually use these files and directories
in project root directory (which become home directory inside Inferno):

    namespace
    profile
    tmp/
    keyring/


=head1 DEPENDENCIES

OS Inferno.


=head1 INCOMPATIBILITIES

None reported.


=head1 BUGS AND LIMITATIONS

No bugs have been reported.

Please report any bugs or feature requests to
C<bug-narada@rt.cpan.org>, or through the web interface at
L<http://rt.cpan.org>.


=head1 AUTHOR

Alex Efros C<< <powerman@cpan.org> >>


=head1 LICENSE AND COPYRIGHT

This software is Copyright (c) 2008-2015 by Alex Efros E<lt>powerman@cpan.orgE<gt>.

This is free software, licensed under:

  The MIT (X11) License


=cut
