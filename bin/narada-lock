#!/usr/bin/perl
use warnings;
use strict;

our $VERSION = '1.3.15';

use FindBin;
use lib "$FindBin::Bin/../lib/perl5";
use Narada::Lock qw( shared_lock child_inherit_lock );

local @ARGV = @ARGV ? @ARGV : ('env', 'PS1=[SHARED] \u@\h \w \$ ', 'bash', '--norc');

shared_lock();
child_inherit_lock(1);
exec @ARGV;


__END__

=encoding utf8

=head1 NAME

narada-lock - run command under shared lock


=head1 VERSION

This document describes narada-lock version v1.4.4


=head1 USAGE

    narada-lock [/path/to/commands param ...]


=head1 DESCRIPTION

Wrapper for running other processes (usually shell-script) with shared_lock().

When executed without params will run `bash --norc` with '[SHARED]' prefix
in $PS1.

Exit status of narada-lock will be same as exit status of executed command.

Script must be executed only from "project root directory".


=head1 REQUIRED ARGUMENTS

None.


=head1 OPTIONS

See USAGE.


=head1 DIAGNOSTICS

None.


=head1 CONFIGURATION AND ENVIRONMENT

Use var/.lock and var/.lock.new files.


=head1 DEPENDENCIES

None.


=head1 INCOMPATIBILITIES

None reported.


=head1 BUGS AND LIMITATIONS

No bugs have been reported.

Please report any bugs or feature requests to
C<bug-narada@rt.cpan.org>, or through the web interface at
L<http://rt.cpan.org>.


=head1 AUTHOR

Alex Efros C<< <powerman@cpan.org> >>


=head1 LICENSE AND COPYRIGHT

This software is Copyright (c) 2008-2015 by Alex Efros E<lt>powerman@cpan.orgE<gt>.

This is free software, licensed under:

  The MIT (X11) License


=cut
