#!/usr/bin/env bash
VERSION='v1.4.4'

warn()  { echo "$@" >&2;        }
die()   { warn "$@"; exit 1;    }

[ $# -eq 0 ] || die "Usage: narada-mysql"

if [ ! -s config/db/db ]; then
    echo "ERROR: config/db/db absent or empty!"
    exit
fi

restore_umask=$(umask -p)
umask 0077
echo '[client]' > tmp/my.cnf.$$
$restore_umask
echo database   = "$(< config/db/db )"          >> tmp/my.cnf.$$
echo user       = "$(< config/db/login )"       >> tmp/my.cnf.$$
[ -s config/db/pass ] && echo password  = "$(< config/db/pass )" >> tmp/my.cnf.$$
[ -s config/db/host ] && echo host      = "$(< config/db/host )" >> tmp/my.cnf.$$
[ -s config/db/port ] && echo port      = "$(< config/db/port )" >> tmp/my.cnf.$$
exec 3< tmp/my.cnf.$$
rm tmp/my.cnf.$$
exec mysql --defaults-file=/proc/self/fd/3 --pager=less\ -XSFe


: <<'=cut'

=encoding utf8

=head1 NAME

narada-mysql - start mysql client for this project


=head1 VERSION

This document describes narada-mysql version v1.4.4


=head1 USAGE

    narada-mysql


=head1 DESCRIPTION

Start mysql client using connection details from config/db/*.

Script must be executed only from "project root directory".


=head1 REQUIRED ARGUMENTS

None.


=head1 OPTIONS

See USAGE.


=head1 DIAGNOSTICS

None.


=head1 CONFIGURATION AND ENVIRONMENT

Use files:
  config/db/db
  config/db/login
  config/db/pass
  config/db/host (optional)
  config/db/port (optional)


=head1 DEPENDENCIES

None.


=head1 INCOMPATIBILITIES

None reported.


=head1 BUGS AND LIMITATIONS

No bugs have been reported.

Please report any bugs or feature requests to
C<bug-narada@rt.cpan.org>, or through the web interface at
L<http://rt.cpan.org>.


=head1 AUTHOR

Alex Efros C<< <powerman@cpan.org> >>


=head1 LICENSE AND COPYRIGHT

This software is Copyright (c) 2008-2015 by Alex Efros E<lt>powerman@cpan.orgE<gt>.

This is free software, licensed under:

  The MIT (X11) License


=cut
