#!/usr/bin/env bash
VERSION='v1.4.4'

perl -ne 'print if ($rec+=/^\S/) == 1' doc/ChangeLog  >tmp/ChangeLog.$$
# Mutt options:
#   1) list of attached files: -a file1 -a file2 ...
#   2) subject
#   3) file with email body
#   4) disabling 'editor' to avoid editing email body
#   5) don't wait for To: recipient list confirmation
#   6) enable email encrypting and signing
#   7) send command 'y' - i.e. "send email"
#   8) recipient list excluding myself
version=$(< config/version )
mutt									\
    $(ls var/patch/$version.$USER.* | sed 's,^,-a ,')			\
    -s "patch: $version"						\
    -i "tmp/ChangeLog.$$"						\
    -e 'set editor=/bin/true'						\
    -e 'set autoedit=yes'						\
    -e 'set edit_headers=yes'						\
    -e 'send-hook . set crypt_autoencrypt=yes crypt_autosign=yes'	\
    -e 'send2-hook . push y'						\
    -- "$(find config/patch/send/ -type f -not -name "$USER" -exec grep -qvFxe "$NARADA_USER" {} \; -exec cat {} +)"
rm tmp/ChangeLog.$$

exit
: <<'=cut'

=encoding utf8

=head1 NAME

narada-patch-send - send latests patch files by email to other developers


=head1 VERSION

This document describes narada-patch-send version v1.4.4


=head1 USAGE

    narada-patch-send


=head1 DESCRIPTION

Script must be executed only from "project root directory".


=head1 REQUIRED ARGUMENTS

None.


=head1 OPTIONS

See USAGE.


=head1 DIAGNOSTICS

None.


=head1 CONFIGURATION AND ENVIRONMENT

TODO


=head1 DEPENDENCIES

None.


=head1 INCOMPATIBILITIES

None reported.


=head1 BUGS AND LIMITATIONS

No bugs have been reported.

Please report any bugs or feature requests to
C<bug-narada@rt.cpan.org>, or through the web interface at
L<http://rt.cpan.org>.


=head1 AUTHOR

Alex Efros C<< <powerman@cpan.org> >>


=head1 LICENSE AND COPYRIGHT

This software is Copyright (c) 2008-2015 by Alex Efros E<lt>powerman@cpan.orgE<gt>.

This is free software, licensed under:

  The MIT (X11) License


=cut
